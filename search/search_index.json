{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Sal","text":"<p>Go backend for Salvia \u2014 an AI-powered clinical note generation platform.</p> <p>Staff record audio notes about patient care, AI transcribes and structures them into clinical forms, and verified notes are added to patient timelines.</p> <p> </p>"},{"location":"#prerequisites","title":"Prerequisites","text":"<ul> <li>Go 1.23+</li> <li>Docker (for local PostgreSQL)</li> </ul>"},{"location":"#quick-start","title":"Quick Start","text":""},{"location":"#1-clone-configure","title":"1. Clone &amp; configure","text":"<pre><code>git clone https://github.com/off-by-2/sal.git\ncd sal\ncp .env.example .env\n</code></pre>"},{"location":"#2-start-the-database","title":"2. Start the database","text":"<pre><code>docker compose up postgres -d\n</code></pre>"},{"location":"#3-initialize-schema-migrations","title":"3. Initialize Schema (Migrations)","text":"<pre><code>make migrate-up\n</code></pre>"},{"location":"#4-run-the-api","title":"4. Run the API","text":"<pre><code>make run\n</code></pre>"},{"location":"#5-verify","title":"5. Verify","text":"<pre><code>make test\n</code></pre>"},{"location":"#before-opening-a-pr","title":"\ud83d\ude80 Before Opening a PR","text":"<p>Ensure your code is clean and tested:</p> <pre><code># 1. Format and Lint\nmake lint\n\n# 2. Run Tests\nmake test\n\n# 3. Update Documentation (Swagger)\nmake swagger\n\n# 4. Verify Build\nmake build\n</code></pre>"},{"location":"#development-commands","title":"Development Commands","text":"<p>We use <code>make</code> for common tasks:</p> Command Description <code>make all</code> Run linter, tests, and build <code>make run</code> Run API locally <code>make test</code> Run tests with coverage <code>make lint</code> Run code quality checks <code>make migrate-up</code> Apply database migrations <code>make migrate-down</code> Rollback last migration <code>make docker-up</code> Start local Postgres <code>make docs-serve</code> View local documentation"},{"location":"#environment-variables","title":"Environment Variables","text":"Variable Description Default <code>DATABASE_URL</code> PostgreSQL connection string <code>postgres://salvia:localdev@localhost:5432/salvia?sslmode=disable</code> <code>PORT</code> API server port <code>8000</code> <code>ENV</code> Environment (<code>development</code>, <code>production</code>) <code>development</code>"},{"location":"#database","title":"Database","text":"<p>The schema is managed by goose migrations in <code>migrations/</code>.</p> <p>To reset the database (drops all data):</p> <pre><code>docker compose down -v\ndocker compose up postgres -d\ngo run ./cmd/migrate -cmd=up\n</code></pre>"},{"location":"#docker","title":"Docker","text":"<p>Run the full stack (API + database):</p> <pre><code>docker compose up\n</code></pre> <p>Or just the database (recommended for development \u2014 run Go natively for faster iteration):</p> <pre><code>docker compose up postgres -d\ngo run ./cmd/api\n</code></pre>"},{"location":"#project-structure","title":"Project Structure","text":"<pre><code>sal/\n\u251c\u2500\u2500 cmd/api/            # Application entrypoint\n\u251c\u2500\u2500 internal/\n\u2502   \u251c\u2500\u2500 config/         # Environment config loading\n\u2502   \u251c\u2500\u2500 database/       # PostgreSQL connection (pgx)\n\u2502   \u2514\u2500\u2500 response/       # Standardized JSON responses\n\u251c\u2500\u2500 migrations/         # Database schema (goose)\n\u251c\u2500\u2500 docker-compose.yml  # Local dev (Postgres + API)\n\u251c\u2500\u2500 Dockerfile          # Production build\n\u2514\u2500\u2500 .env.example        # Environment template\n</code></pre>"},{"location":"#documentation","title":"Documentation","text":"<ul> <li>Development: Run <code>pkgsite -http=:6060</code> locally.</li> <li>Production: Documentation is automatically deployed to GitHub Pages :   https://off-by-2.github.io/sal/</li> </ul> <p>To edit documentation: - Home: Edit <code>README.md</code>. - API: Edit Go code comments (auto-generated). - Navigation: Edit <code>mkdocs.yml</code>.</p>"},{"location":"#license","title":"License","text":"<p>MIT License with Commons Clause \u2014 see LICENSE.</p>"},{"location":"ARCHITECTURE/","title":"Salvia System Architecture","text":"<p>The \"Salvia Way\": No Magic. Explicit SQL. Native Auth. High Performance.</p> <p>This document is the Technical Manual for the Salvia backend. It explains how the system works, how data is structured, and how security is enforced.</p>"},{"location":"ARCHITECTURE/#1-high-level-design","title":"1. High-Level Design","text":"<p>Salvia is a monolith API built in Go. It interacts with Postgres (Data), Redis (Cache), and S3 (Storage).</p> <pre><code>graph TD\n    Client[Mobile/Web] --&gt;|HTTPS| Router[Chi Router]\n    Router --&gt; Middleware[Auth &amp; Logger]\n    Middleware --&gt; Handlers[HTTP Handlers]\n    Handlers --&gt; Service[Business Logic]\n    Service --&gt; Repo[Data Layer]\n    Repo --&gt; DB[(Postgres)]\n</code></pre>"},{"location":"ARCHITECTURE/#core-technologies","title":"Core Technologies","text":"<ul> <li>Go 1.25+: Strong typing, concurrency.</li> <li>Postgres 16: Primary source of truth.</li> <li>pgx/v5: High-performance database driver.</li> <li>Chi: Zero-allocation HTTP router.</li> </ul>"},{"location":"ARCHITECTURE/#2-authentication-authorization","title":"2. Authentication &amp; Authorization","text":"<p>We use a Native Auth system (replacing Supabase).</p>"},{"location":"ARCHITECTURE/#a-identities","title":"A. Identities","text":"<ul> <li>Users (<code>users</code> table): Global identity (Email/Password).</li> <li>Staff (<code>staff</code> table): Membership in an Organization.</li> <li>Invitations (<code>staff_invitations</code> table): Temporary access tokens.</li> </ul>"},{"location":"ARCHITECTURE/#b-security-strategy","title":"B. Security Strategy","text":"<ol> <li>Passwords: Hashed using <code>bcrypt</code> (Cost 12). Never stored plain.</li> <li>Tokens: Dual-token system.<ul> <li>Access Token (JWT): Short-lived (15m). Used for API calls.</li> <li>Refresh Token (Opaque): Long-lived (7d). Stored in HTTP-Only cookie. Used to get new Access Tokens.</li> </ul> </li> <li>RBAC (Permissions):<ul> <li><code>Role='admin'</code>: Unlimited access.</li> <li><code>Role='staff'</code>: Checks <code>staff.permissions</code> JSONB column (e.g., <code>{\"can_view_notes\": true}</code>).</li> </ul> </li> </ol>"},{"location":"ARCHITECTURE/#c-the-login-flow","title":"C. The Login Flow","text":"<ol> <li>User posts <code>email</code> + <code>password</code>.</li> <li>Server verifies hash.</li> <li>Server issues Access Token (Body) + Refresh Token (Cookie).</li> </ol>"},{"location":"ARCHITECTURE/#3-database-design","title":"3. Database Design","text":"<p>We use 19 Tables optimized for clinical workflows.</p>"},{"location":"ARCHITECTURE/#key-decisions","title":"Key Decisions","text":"<ul> <li>UUIDs (v7): Used everywhere for primary keys (sortable timeline).</li> <li>JSONB: Used for flexible data (Permissions, Form Templates).</li> <li>Triggers: Used for auditing (<code>updated_at</code>) and versioning (<code>increment_version</code>).</li> </ul>"},{"location":"ARCHITECTURE/#core-domains","title":"Core Domains","text":"<ol> <li>Organization: <code>organizations</code>, <code>staff</code>, <code>groups</code>.</li> <li>Patients: <code>beneficiaries</code>, <code>beneficiary_group_assignments</code>.</li> <li>Notes: <code>audio_notes</code>, <code>generated_notes</code>, <code>form_templates</code>.</li> </ol>"},{"location":"ARCHITECTURE/#4-key-workflows","title":"4. Key Workflows","text":""},{"location":"ARCHITECTURE/#staff-onboarding-magic-invite","title":"Staff Onboarding (Magic Invite)","text":"<ol> <li>Admin generates invite -&gt; <code>staff_invitations</code> table.</li> <li>Email sent with link -&gt; <code>app.sal.com/join?token=XYZ</code>.</li> <li>Staff clicks -&gt; Validates Token -&gt; Sets Password -&gt; Account Active.</li> </ol>"},{"location":"ARCHITECTURE/#audio-processing","title":"Audio Processing","text":"<ol> <li>Mobile App uploads audio -&gt; <code>audio_notes</code> (Status: <code>pending</code>).</li> <li>Background Worker picks up job -&gt; Transcribes (Whisper) -&gt; Summarizes (LLM).</li> <li>Result saved to <code>generated_notes</code> (Status: <code>draft</code>).</li> </ol>"},{"location":"ROADMAP/","title":"Sal (Salvia) Development Roadmap","text":"<p>This document outlines the detailed plan to build the Salvia Go backend. Each phase builds upon the last, delivering a testable increment.</p>"},{"location":"ROADMAP/#phase-1-foundation-complete","title":"\u2705 Phase 1: Foundation (Complete)","text":"<ul> <li>[x] Project Setup: Go Module (<code>go.mod</code>), <code>.gitignore</code>, <code>.env</code>.</li> <li>[x] Infrastructure: <code>Dockerfile</code>, <code>docker-compose.yml</code>, <code>Makefile</code>.</li> <li>[x] Database: Migration system (<code>goose</code>), Schema (<code>19 tables</code>).</li> <li>[x] CI/CD: Quality checks (<code>quality.yml</code>), Docs deployment (<code>docs.yml</code>).</li> </ul>"},{"location":"ROADMAP/#phase-2-core-api-complete","title":"\u2705 Phase 2: Core API (Complete)","text":"<ul> <li>[x] Database Module: <code>internal/database</code> (pgxpool).</li> <li>[x] Response Format: <code>internal/response</code> (Standard JSON).</li> <li>[x] Server: <code>cmd/api</code> (Chi Router, Graceful Shutdown, Health Check).</li> </ul>"},{"location":"ROADMAP/#phase-3-authentication-native-go-auth","title":"\u2705 Phase 3: Authentication (Native Go Auth)","text":"<p>Replcaed Supabase Auth. Complete.</p>"},{"location":"ROADMAP/#3a-core-crypto-logic","title":"3a. Core Crypto Logic","text":"<ul> <li>[x] Dependencies: Install <code>bcrypt</code> + <code>jwt/v5</code>.</li> <li>[x] Password Helper: <code>internal/auth/password.go</code> (<code>Hash</code>, <code>Compare</code>).</li> <li>[x] Token Helper: <code>internal/auth/token.go</code> (<code>NewAccess</code>, <code>NewRefresh</code>, <code>Parse</code>).</li> </ul>"},{"location":"ROADMAP/#3b-data-access-repositories","title":"3b. Data Access (Repositories)","text":"<ul> <li>[x] User Queries: <code>CreateUser</code>, <code>GetUserByEmail</code>.</li> <li>[x] Org Queries: <code>CreateOrganization</code>.</li> <li>[x] Staff Queries: <code>CreateStaff</code>, <code>GetStaffByUserID</code>.</li> </ul>"},{"location":"ROADMAP/#3c-http-handlers","title":"3c. HTTP Handlers","text":"<ul> <li>[x] Register Endpoint: <code>POST /auth/register</code>.<ul> <li>Transaction: Create User -&gt; Org -&gt; Staff (Admin).</li> <li>Return: Access + Refresh Tokens.</li> </ul> </li> <li>[x] Login Endpoint: <code>POST /auth/login</code>.<ul> <li>Check Password -&gt; Issue Tokens.</li> </ul> </li> </ul>"},{"location":"ROADMAP/#3d-middleware","title":"3d. Middleware","text":"<ul> <li>[x] Auth Middleware: Check <code>Authorization: Bearer ...</code>.</li> <li>[ ] Permission Middleware: Check <code>staff.permissions</code> JSON.</li> </ul>"},{"location":"ROADMAP/#phase-4-organization-management","title":"\ud83d\udd2e Phase 4: Organization Management","text":"<p>Manage Tenants, Staff, and Patients. Estimated: 3-4 Days.</p>"},{"location":"ROADMAP/#4a-staff-invites","title":"4a. Staff &amp; Invites","text":"<ul> <li>[ ] <code>POST /orgs/:id/invite</code> (Generate token).</li> <li>[ ] <code>POST /invitations/accept</code> (Exchange token for account).</li> <li>[ ] Repo: <code>GetInvitationByToken</code>, <code>DeleteInvitation</code>.</li> </ul>"},{"location":"ROADMAP/#4b-groups-wards","title":"4b. Groups (Wards)","text":"<ul> <li>[ ] CRUD for <code>groups</code> table.</li> <li>[ ] <code>staff_group_assignments</code> (Link Staff &lt;-&gt; Group).</li> </ul>"},{"location":"ROADMAP/#4c-patients-beneficiaries","title":"4c. Patients (Beneficiaries)","text":"<ul> <li>[ ] CRUD for <code>beneficiaries</code>.</li> <li>[ ] <code>beneficiary_group_assignments</code> (Admit/Discharge).</li> <li>[ ] Search: Implement Trigram Search (<code>pg_trgm</code>) query.</li> </ul>"},{"location":"ROADMAP/#phase-5-clinical-forms-templates","title":"\ud83d\udd2e Phase 5: Clinical Forms &amp; Templates","text":"<p>Dynamic Form Builder. Estimated: 3 Days.</p>"},{"location":"ROADMAP/#5a-templates","title":"5a. Templates","text":"<ul> <li>[ ] CRUD for <code>form_templates</code> (JSON Schema).</li> <li>[ ] Versioning logic (<code>template_key</code> + <code>version</code>).</li> </ul>"},{"location":"ROADMAP/#5b-document-flows","title":"5b. Document Flows","text":"<ul> <li>[ ] <code>document_flows</code> (Workflow definitions).</li> </ul>"},{"location":"ROADMAP/#phase-6-core-product-ai-notes","title":"\ud83d\udd2e Phase 6: Core Product (AI Notes)","text":"<p>Audio Processing Pipeline. Estimated: 5-7 Days.</p>"},{"location":"ROADMAP/#6a-audio-upload","title":"6a. Audio Upload","text":"<ul> <li>[ ] <code>POST /audio-notes</code>: Upload file to S3/MinIO.</li> <li>[ ] Architecture: Signed URLs vs Direct Upload.</li> </ul>"},{"location":"ROADMAP/#6b-transcription-generation","title":"6b. Transcription &amp; Generation","text":"<ul> <li>[ ] Worker: Background job to process audio.</li> <li>[ ] LLM: Integration with Anthropic/OpenAI API.</li> <li>[ ] Optimistic Locking: Handle concurrent edits on <code>generated_notes</code>.</li> </ul>"},{"location":"ROADMAP/#phase-7-advanced-features","title":"\ud83d\udd2e Phase 7: Advanced Features","text":"<ul> <li>[ ] WS: WebSockets for real-time status updates.</li> <li>[ ] 2FA: TOTP implementation.</li> <li>[ ] OAuth: Google Login.</li> </ul>"},{"location":"reference/","title":"API Reference","text":""},{"location":"reference/#docs","title":"docs","text":"<pre><code>import \"github.com/off-by-2/sal/docs\"\n</code></pre> <p>Package docs Code generated by swaggo/swag. DO NOT EDIT</p>"},{"location":"reference/#index","title":"Index","text":"<ul> <li>Variables</li> </ul>"},{"location":"reference/#variables","title":"Variables","text":"<p>SwaggerInfo holds exported Swagger Info so clients can modify it</p> <pre><code>var SwaggerInfo = &amp;swag.Spec{\n    Version:          \"1.0\",\n    Host:             \"localhost:8000\",\n    BasePath:         \"/api/v1\",\n    Schemes:          []string{},\n    Title:            \"Sal API\",\n    Description:      \"The high-performance backend for Salvia (Sal).\",\n    InfoInstanceName: \"swagger\",\n    SwaggerTemplate:  docTemplate,\n    LeftDelim:        \"{{\",\n    RightDelim:       \"}}\",\n}\n</code></pre>"},{"location":"reference/#migrations","title":"migrations","text":"<pre><code>import \"github.com/off-by-2/sal/migrations\"\n</code></pre> <p>Package migrations embeds database migration files.</p>"},{"location":"reference/#index_1","title":"Index","text":"<ul> <li>Variables</li> </ul>"},{"location":"reference/#variables_1","title":"Variables","text":"<p>FS holds the embedded migration SQL files. It is used by goose to run migrations.</p> <pre><code>var FS embed.FS\n</code></pre>"},{"location":"reference/#api","title":"api","text":"<pre><code>import \"github.com/off-by-2/sal/cmd/api\"\n</code></pre> <p>Package main serves as the entry point for the Sal API server. It handles dependency injection, route configuration, and graceful shutdown.</p> <p>@title Sal API @version 1.0 @description The high-performance backend for Salvia (Sal). @termsOfService http://swagger.io/terms/</p> <p>@contact.name API Support @contact.url http://www.swagger.io/support @contact.email support@salvia.com</p> <p>@license.name MIT @license.url https://opensource.org/licenses/MIT</p> <p>@host localhost:8000 @BasePath /api/v1</p> <p>Package main serves as the entry point for the Sal API server. It handles dependency injection, route configuration, and graceful shutdown.</p>"},{"location":"reference/#index_2","title":"Index","text":"<ul> <li>type Server</li> <li>func NewServer(cfg *config.Config, db *database.Postgres) *Server</li> <li>func (s *Server) Shutdown(ctx context.Context) error</li> <li>func (s *Server) Start() error</li> </ul>"},{"location":"reference/#type-server","title":"type Server","text":"<p>Server is the main HTTP server container. It holds references to all shared dependencies required by HTTP handlers.</p> <pre><code>type Server struct {\n    Router *chi.Mux           // Router handles HTTP routing\n    DB     *database.Postgres // DB provides access to the database connection pool\n    Config *config.Config     // Config holds application configuration\n    // contains filtered or unexported fields\n}\n</code></pre> <p></p>"},{"location":"reference/#func-newserver","title":"func NewServer","text":"<pre><code>func NewServer(cfg *config.Config, db *database.Postgres) *Server\n</code></pre> <p>NewServer creates and configures a new HTTP server.</p> <p></p>"},{"location":"reference/#func-server-shutdown","title":"func (*Server) Shutdown","text":"<pre><code>func (s *Server) Shutdown(ctx context.Context) error\n</code></pre> <p>Shutdown gracefully stops the HTTP server.</p> <p></p>"},{"location":"reference/#func-server-start","title":"func (*Server) Start","text":"<pre><code>func (s *Server) Start() error\n</code></pre> <p>Start runs the HTTP server.</p>"},{"location":"reference/#migrate","title":"migrate","text":"<pre><code>import \"github.com/off-by-2/sal/cmd/migrate\"\n</code></pre> <p>Package main is the entrypoint for the database migration tool. It uses pressly/goose to manage database schema versions.</p>"},{"location":"reference/#index_3","title":"Index","text":""},{"location":"reference/#auth","title":"auth","text":"<pre><code>import \"github.com/off-by-2/sal/internal/auth\"\n</code></pre> <p>Package auth provides authentication primitives.</p>"},{"location":"reference/#index_4","title":"Index","text":"<ul> <li>Constants</li> <li>func CheckPasswordHash(password, hash string) error</li> <li>func HashPassword(password string) (string, error)</li> <li>func NewAccessToken(userID, orgID, role, secret string) (string, error)</li> <li>func NewRefreshToken() (string, error)</li> <li>type Claims</li> <li>func ParseAccessToken(tokenString, secret string) (*Claims, error)</li> </ul>"},{"location":"reference/#constants","title":"Constants","text":"<p>AccessTokenDuration is the lifespan of an access token (15 minutes).</p> <pre><code>const AccessTokenDuration = 15 * time.Minute\n</code></pre> <p>RefreshTokenLen is the byte length of the refresh token (32 bytes = 64 hex chars).</p> <pre><code>const RefreshTokenLen = 32\n</code></pre> <p></p>"},{"location":"reference/#func-checkpasswordhash","title":"func CheckPasswordHash","text":"<pre><code>func CheckPasswordHash(password, hash string) error\n</code></pre> <p>CheckPasswordHash compares a bcrypt hashed password with a plain text password. Returns nil if the passwords match, or an error if they don't.</p> <p></p>"},{"location":"reference/#func-hashpassword","title":"func HashPassword","text":"<pre><code>func HashPassword(password string) (string, error)\n</code></pre> <p>HashPassword hashes a plain text password using bcrypt with a default cost.</p> <p></p>"},{"location":"reference/#func-newaccesstoken","title":"func NewAccessToken","text":"<pre><code>func NewAccessToken(userID, orgID, role, secret string) (string, error)\n</code></pre> <p>NewAccessToken creates a signed JWT for the given user context.</p> <p></p>"},{"location":"reference/#func-newrefreshtoken","title":"func NewRefreshToken","text":"<pre><code>func NewRefreshToken() (string, error)\n</code></pre> <p>NewRefreshToken generates a secure random hex string. This matches the format expected by the 'refresh_tokens' table.</p> <p></p>"},{"location":"reference/#type-claims","title":"type Claims","text":"<p>Claims represents the JWT payload.</p> <pre><code>type Claims struct {\n    UserID string `json:\"sub\"`\n    OrgID  string `json:\"org_id,omitempty\"`\n    Role   string `json:\"role,omitempty\"`\n    jwt.RegisteredClaims\n}\n</code></pre> <p></p>"},{"location":"reference/#func-parseaccesstoken","title":"func ParseAccessToken","text":"<pre><code>func ParseAccessToken(tokenString, secret string) (*Claims, error)\n</code></pre> <p>ParseAccessToken validates the token string and returns the claims.</p>"},{"location":"reference/#config","title":"config","text":"<pre><code>import \"github.com/off-by-2/sal/internal/config\"\n</code></pre> <p>Package config handles environment variable loading and application configuration.</p>"},{"location":"reference/#index_5","title":"Index","text":"<ul> <li>type Config</li> <li>func Load() *Config</li> </ul>"},{"location":"reference/#type-config","title":"type Config","text":"<p>Config holds all configuration values for the application.</p> <pre><code>type Config struct {\n    DatabaseURL string\n    Port        string\n    Env         string\n    JWTSecret   string\n}\n</code></pre> <p></p>"},{"location":"reference/#func-load","title":"func Load","text":"<pre><code>func Load() *Config\n</code></pre> <p>Load retrieves configuration from environment variables. It attempts to load from a .env file first, falling back to system environment variables. Default values are provided for development convenience.</p>"},{"location":"reference/#database","title":"database","text":"<pre><code>import \"github.com/off-by-2/sal/internal/database\"\n</code></pre> <p>Package database manages the PostgreSQL connection pool and related utilities.</p>"},{"location":"reference/#index_6","title":"Index","text":"<ul> <li>type Postgres</li> <li>func New(ctx context.Context, connectionString string) (*Postgres, error)</li> <li>func (p *Postgres) Close()</li> <li>func (p *Postgres) Health(ctx context.Context) error</li> </ul>"},{"location":"reference/#type-postgres","title":"type Postgres","text":"<p>Postgres holds the connection pool to the database.</p> <pre><code>type Postgres struct {\n    Pool *pgxpool.Pool\n}\n</code></pre> <p></p>"},{"location":"reference/#func-new","title":"func New","text":"<pre><code>func New(ctx context.Context, connectionString string) (*Postgres, error)\n</code></pre> <p>New creates a new Postgres connection pool with optimized production settings. It parses the connection string, sets connection limits, and verifies the connection with a Ping.</p> <p></p>"},{"location":"reference/#func-postgres-close","title":"func (*Postgres) Close","text":"<pre><code>func (p *Postgres) Close()\n</code></pre> <p>Close ensures the database connection pool allows graceful shutdown. It waits for active queries to finish before closing connections.</p> <p></p>"},{"location":"reference/#func-postgres-health","title":"func (*Postgres) Health","text":"<pre><code>func (p *Postgres) Health(ctx context.Context) error\n</code></pre> <p>Health checks the status of the database connection. It returns nil if the database is reachable, or an error if it is not.</p>"},{"location":"reference/#handler","title":"handler","text":"<pre><code>import \"github.com/off-by-2/sal/internal/handler\"\n</code></pre> <p>Package handler provides HTTP handlers for the API.</p>"},{"location":"reference/#index_7","title":"Index","text":"<ul> <li>type AuthHandler</li> <li>func NewAuthHandler(db *database.Postgres, userEq *repository.UserRepository, orgEq *repository.OrganizationRepository, staffEq *repository.StaffRepository, jwtSecret string) *AuthHandler</li> <li>func (h *AuthHandler) Login(w http.ResponseWriter, r *http.Request)</li> <li>func (h *AuthHandler) Register(w http.ResponseWriter, r *http.Request)</li> <li>type LoginInput</li> <li>type RegisterInput</li> </ul>"},{"location":"reference/#type-authhandler","title":"type AuthHandler","text":"<p>AuthHandler handles authentication requests.</p> <pre><code>type AuthHandler struct {\n    DB        *database.Postgres\n    UserRepo  *repository.UserRepository\n    OrgRepo   *repository.OrganizationRepository\n    StaffRepo *repository.StaffRepository\n    JWTSecret string\n    Validator *validator.Validate\n}\n</code></pre> <p></p>"},{"location":"reference/#func-newauthhandler","title":"func NewAuthHandler","text":"<pre><code>func NewAuthHandler(db *database.Postgres, userEq *repository.UserRepository, orgEq *repository.OrganizationRepository, staffEq *repository.StaffRepository, jwtSecret string) *AuthHandler\n</code></pre> <p>NewAuthHandler creates a new AuthHandler.</p> <p></p>"},{"location":"reference/#func-authhandler-login","title":"func (*AuthHandler) Login","text":"<pre><code>func (h *AuthHandler) Login(w http.ResponseWriter, r *http.Request)\n</code></pre> <p>Login authenticates a user and returns tokens. @Summary Login @Description Authenticates user by email/password and returns JWT pairs. @Tags auth @Accept json @Produce json @Param input body LoginInput true \"Login Credentials\" @Success 200 {object} response.Response{data=map[string]string} \"Tokens\" @Failure 401 {object} response.Response \"Unauthorized\" @Router /auth/login [post]</p> <p></p>"},{"location":"reference/#func-authhandler-register","title":"func (*AuthHandler) Register","text":"<pre><code>func (h *AuthHandler) Register(w http.ResponseWriter, r *http.Request)\n</code></pre> <p>Register creates a new user, organization, and admin staff entry atomically. @Summary Register a new Admin @Description Creates a new User, Organization, and links them as Admin Staff. @Tags auth @Accept json @Produce json @Param input body RegisterInput true \"Registration Config\" @Success 201 {object} response.Response{data=map[string]interface{}} \"User and Org created\" @Failure 400 {object} response.Response \"Validation Error\" @Failure 500 {object} response.Response \"Internal Server Error\" @Router /auth/register [post]</p> <p></p>"},{"location":"reference/#type-logininput","title":"type LoginInput","text":"<p>LoginInput defines the payload for login.</p> <pre><code>type LoginInput struct {\n    Email    string `json:\"email\" validate:\"required,email\"`\n    Password string `json:\"password\" validate:\"required\"`\n}\n</code></pre> <p></p>"},{"location":"reference/#type-registerinput","title":"type RegisterInput","text":"<p>RegisterInput defines the payload for admin registration.</p> <pre><code>type RegisterInput struct {\n    Email     string `json:\"email\" validate:\"required,email\"`\n    Password  string `json:\"password\" validate:\"required,min=8\"`\n    FirstName string `json:\"first_name\" validate:\"required\"`\n    LastName  string `json:\"last_name\" validate:\"required\"`\n    OrgName   string `json:\"org_name\" validate:\"required\"`\n}\n</code></pre>"},{"location":"reference/#repository","title":"repository","text":"<pre><code>import \"github.com/off-by-2/sal/internal/repository\"\n</code></pre> <p>Package repository implements data access for the Salvia application.</p> <p>Package repository implements data access for the Salvia application.</p>"},{"location":"reference/#index_8","title":"Index","text":"<ul> <li>Variables</li> <li>type Organization</li> <li>type OrganizationRepository</li> <li>func NewOrganizationRepository(db *database.Postgres) *OrganizationRepository</li> <li>func (r *OrganizationRepository) CreateOrg(ctx context.Context, o *Organization) error</li> <li>type Staff</li> <li>type StaffRepository</li> <li>func NewStaffRepository(db *database.Postgres) *StaffRepository</li> <li>func (r *StaffRepository) CreateStaff(ctx context.Context, s *Staff) error</li> <li>type User</li> <li>type UserRepository</li> <li>func NewUserRepository(db *database.Postgres) *UserRepository</li> <li>func (r *UserRepository) CreateUser(ctx context.Context, u *User) error</li> <li>func (r *UserRepository) GetUserByEmail(ctx context.Context, email string) (*User, error)</li> </ul>"},{"location":"reference/#variables_2","title":"Variables","text":"<pre><code>var (\n    // ErrUserNotFound is returned when a user cannot be found in the database.\n    ErrUserNotFound = errors.New(\"user not found\")\n    // ErrDuplicateEmail is returned when an email is already taken.\n    ErrDuplicateEmail = errors.New(\"email already exists\")\n)\n</code></pre>"},{"location":"reference/#type-organization","title":"type Organization","text":"<p>Organization represents a row in the organizations table.</p> <pre><code>type Organization struct {\n    ID        string    `json:\"id\"`\n    Name      string    `json:\"name\"`\n    Slug      string    `json:\"slug\"`\n    OwnerID   string    `json:\"owner_id\"`\n    CreatedAt time.Time `json:\"created_at\"`\n    UpdatedAt time.Time `json:\"updated_at\"`\n}\n</code></pre> <p></p>"},{"location":"reference/#type-organizationrepository","title":"type OrganizationRepository","text":"<p>OrganizationRepository handles database operations for organizations.</p> <pre><code>type OrganizationRepository struct {\n    // contains filtered or unexported fields\n}\n</code></pre> <p></p>"},{"location":"reference/#func-neworganizationrepository","title":"func NewOrganizationRepository","text":"<pre><code>func NewOrganizationRepository(db *database.Postgres) *OrganizationRepository\n</code></pre> <p>NewOrganizationRepository creates a new OrganizationRepository.</p> <p></p>"},{"location":"reference/#func-organizationrepository-createorg","title":"func (*OrganizationRepository) CreateOrg","text":"<pre><code>func (r *OrganizationRepository) CreateOrg(ctx context.Context, o *Organization) error\n</code></pre> <p>CreateOrg inserts a new organization.</p> <p></p>"},{"location":"reference/#type-staff","title":"type Staff","text":"<p>Staff represents a row in the staff table.</p> <pre><code>type Staff struct {\n    ID             string                 `json:\"id\"`\n    OrganizationID string                 `json:\"organization_id\"`\n    UserID         string                 `json:\"user_id\"`\n    Role           string                 `json:\"role\"`        // 'admin' or 'staff'\n    Permissions    map[string]interface{} `json:\"permissions\"` // JSONB\n    CreatedAt      time.Time              `json:\"created_at\"`\n    UpdatedAt      time.Time              `json:\"updated_at\"`\n}\n</code></pre> <p></p>"},{"location":"reference/#type-staffrepository","title":"type StaffRepository","text":"<p>StaffRepository handles database operations for staff.</p> <pre><code>type StaffRepository struct {\n    // contains filtered or unexported fields\n}\n</code></pre> <p></p>"},{"location":"reference/#func-newstaffrepository","title":"func NewStaffRepository","text":"<pre><code>func NewStaffRepository(db *database.Postgres) *StaffRepository\n</code></pre> <p>NewStaffRepository creates a new StaffRepository.</p> <p></p>"},{"location":"reference/#func-staffrepository-createstaff","title":"func (*StaffRepository) CreateStaff","text":"<pre><code>func (r *StaffRepository) CreateStaff(ctx context.Context, s *Staff) error\n</code></pre> <p>CreateStaff inserts a new staff member.</p> <p></p>"},{"location":"reference/#type-user","title":"type User","text":"<p>User represents a row in the users table.</p> <pre><code>type User struct {\n    ID              string    `json:\"id\"`\n    Email           string    `json:\"email\"`\n    EmailVerified   bool      `json:\"email_verified\"`\n    PasswordHash    string    `json:\"-\"` // Never return password hash in JSON\n    AuthProvider    string    `json:\"auth_provider\"`\n    FirstName       string    `json:\"first_name\"`\n    LastName        string    `json:\"last_name\"`\n    Phone           *string   `json:\"phone,omitempty\"`\n    ProfileImageURL *string   `json:\"profile_image_url,omitempty\"`\n    IsActive        bool      `json:\"is_active\"`\n    CreatedAt       time.Time `json:\"created_at\"`\n    UpdatedAt       time.Time `json:\"updated_at\"`\n}\n</code></pre> <p></p>"},{"location":"reference/#type-userrepository","title":"type UserRepository","text":"<p>UserRepository handles database operations for users.</p> <pre><code>type UserRepository struct {\n    // contains filtered or unexported fields\n}\n</code></pre> <p></p>"},{"location":"reference/#func-newuserrepository","title":"func NewUserRepository","text":"<pre><code>func NewUserRepository(db *database.Postgres) *UserRepository\n</code></pre> <p>NewUserRepository creates a new UserRepository.</p> <p></p>"},{"location":"reference/#func-userrepository-createuser","title":"func (*UserRepository) CreateUser","text":"<pre><code>func (r *UserRepository) CreateUser(ctx context.Context, u *User) error\n</code></pre> <p>CreateUser inserts a new user into the database.</p> <p></p>"},{"location":"reference/#func-userrepository-getuserbyemail","title":"func (*UserRepository) GetUserByEmail","text":"<pre><code>func (r *UserRepository) GetUserByEmail(ctx context.Context, email string) (*User, error)\n</code></pre> <p>GetUserByEmail retrieves a user by their email address.</p>"},{"location":"reference/#response","title":"response","text":"<pre><code>import \"github.com/off-by-2/sal/internal/response\"\n</code></pre> <p>Package response provides helper functions for sending consistent JSON responses.</p>"},{"location":"reference/#index_9","title":"Index","text":"<ul> <li>func Error(w http.ResponseWriter, status int, message string)</li> <li>func JSON(w http.ResponseWriter, status int, data interface{})</li> <li>func ValidationError(w http.ResponseWriter, err error)</li> <li>type Response</li> </ul>"},{"location":"reference/#func-error","title":"func Error","text":"<pre><code>func Error(w http.ResponseWriter, status int, message string)\n</code></pre> <p>Error sends a standardized error response.</p> <p></p>"},{"location":"reference/#func-json","title":"func JSON","text":"<pre><code>func JSON(w http.ResponseWriter, status int, data interface{})\n</code></pre> <p>JSON sends a JSON response with the given status code and data.</p> <p></p>"},{"location":"reference/#func-validationerror","title":"func ValidationError","text":"<pre><code>func ValidationError(w http.ResponseWriter, err error)\n</code></pre> <p>ValidationError sends a response with detailed validation errors. It parses go-playground/validator errors into a simplified map.</p> <p></p>"},{"location":"reference/#type-response","title":"type Response","text":"<p>Response represents the standard JSON envelope for all API responses.</p> <pre><code>type Response struct {\n    Success bool        `json:\"success\"`         // Success indicates if the request was successful\n    Data    interface{} `json:\"data,omitempty\"`  // Data holds the payload (can be struct, map, or nil)\n    Error   interface{} `json:\"error,omitempty\"` // Error holds error details if Success is false\n    Meta    interface{} `json:\"meta,omitempty\"`  // Meta holds pagination or other metadata\n}\n</code></pre> <p>Generated by gomarkdoc</p>"}]}